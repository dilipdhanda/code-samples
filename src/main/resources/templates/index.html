<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>ZIP Forecast</title>
    <style>
        :root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
        body { max-width: 820px; margin: 2rem auto; padding: 0 1rem; }
        h1 { margin-bottom: 0.75rem; }
        form { display: flex; gap: .5rem; margin-bottom: 1.25rem; }
        input[type="text"]{ flex: 1; padding: .7rem .8rem; border: 1px solid #d0d7de; border-radius: .6rem; }
        button{ padding: .7rem 1rem; border: 1px solid #2f81f7; background:#2f81f7; color:white; border-radius:.6rem; cursor:pointer;}
        button:hover{ background:#1f6feb;}
        .card{ border:1px solid #d0d7de; border-radius: .8rem; padding:1rem; }
        .muted{ color:#57606a; font-size:.9rem; }
        .row{ display:flex; gap:1rem; flex-wrap:wrap; }
        .box{ flex:1 1 220px; border:1px solid #e5e7eb; border-radius:.6rem; padding:.75rem; }
        .badge{ display:inline-block; padding:.15rem .5rem; border-radius:.5rem; font-size:.8rem; margin-left:.5rem;}
        .badge.cache{ background:#fef3c7; color:#92400e; border:1px solid #f59e0b;}
        .badge.live{ background:#dcfce7; color:#065f46; border:1px solid #22c55e;}
        .error{ color:#b42318; background:#fef3f2; border:1px solid #fecdca; padding:.75rem; border-radius:.5rem; }
        .footer{ margin-top:1rem; color:#6b7280; font-size:.85rem;}
        .label{ color:#6b7280; font-size:.85rem; margin-bottom:.25rem;}
        .big{ font-size:2rem; font-weight:700; }
    </style>
</head>
<body>
<h1>ZIP Forecast</h1>
<p class="muted">Enter a street address (e.g., “1 Infinite Loop, Cupertino, CA”). We’ll resolve it to a ZIP and fetch the weather. Results are cached per ZIP for 30 minutes.</p>

<form method="post" action="/forecast">
    <input type="text" name="address" placeholder="Enter address…" th:value="${address}">
    <button type="submit">Get forecast</button>
</form>

<div th:if="${error}" class="error" th:text="${error}"></div>

<div th:if="${result}" class="card">
    <div style="display:flex; align-items:center; gap:.5rem;">
        <div>
            <strong th:text="${resolved}">Resolved place</strong>
            <span class="muted">ZIP <span th:text="${zip}">00000</span></span>
        </div>
        <div th:if="${result.fromCache()}" class="badge cache">from cache</div>
        <div th:if="${!result.fromCache()}" class="badge live">live</div>
    </div>

    <div class="row" style="margin-top: .75rem;">
        <div class="box">
            <div class="label">Current temperature (°C)</div>
            <div class="big" th:text="${#numbers.formatDecimal(result.currentTempC(), 1, 1)}">--</div>
        </div>
        <div class="box">
            <div class="label">Today’s High (°C)</div>
            <div class="big" th:text="${result.todayHighC() != null ? #numbers.formatDecimal(result.todayHighC(),1,1) : '--'}">--</div>
        </div>
        <div class="box">
            <div class="label">Today’s Low (°C)</div>
            <div class="big" th:text="${result.todayLowC() != null ? #numbers.formatDecimal(result.todayLowC(),1,1) : '--'}">--</div>
        </div>
    </div>

    <div class="footer">
        <span>Last updated: </span>
        <span th:text="${#temporals.format(result.fetchedAt(), 'yyyy-MM-dd HH:mm z')}">—</span>
    </div>
</div>
</body>
</html>
